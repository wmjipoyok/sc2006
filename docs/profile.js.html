<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>profile.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-bookings-js.html">bookings-js</a><ul class='methods'><li data-type='method'><a href="module-bookings-js.html#~displayBookings">displayBookings</a></li><li data-type='method'><a href="module-bookings-js.html#~getDaysBetweenDates">getDaysBetweenDates</a></li></ul></li><li><a href="module-car-detail-js.html">car-detail-js</a><ul class='methods'><li data-type='method'><a href="module-car-detail-js.html#~acceptCar">acceptCar</a></li><li data-type='method'><a href="module-car-detail-js.html#~bookCar">bookCar</a></li><li data-type='method'><a href="module-car-detail-js.html#~cancelCar">cancelCar</a></li><li data-type='method'><a href="module-car-detail-js.html#~checkBooking">checkBooking</a></li><li data-type='method'><a href="module-car-detail-js.html#~completeCar">completeCar</a></li><li data-type='method'><a href="module-car-detail-js.html#~deleteCar">deleteCar</a></li><li data-type='method'><a href="module-car-detail-js.html#~errorHandle">errorHandle</a></li><li data-type='method'><a href="module-car-detail-js.html#~getStarRatings">getStarRatings</a></li><li data-type='method'><a href="module-car-detail-js.html#~rejectCar">rejectCar</a></li><li data-type='method'><a href="module-car-detail-js.html#~retrieveCarDetails">retrieveCarDetails</a></li><li data-type='method'><a href="module-car-detail-js.html#~saveMessageToDb">saveMessageToDb</a></li><li data-type='method'><a href="module-car-detail-js.html#~sendMessage">sendMessage</a></li></ul></li><li><a href="module-car-form-js.html">car-form-js</a><ul class='methods'><li data-type='method'><a href="module-car-form-js.html#~addSlideshowJS">addSlideshowJS</a></li><li data-type='method'><a href="module-car-form-js.html#~createCarListing">createCarListing</a></li><li data-type='method'><a href="module-car-form-js.html#~disableInputs">disableInputs</a></li><li data-type='method'><a href="module-car-form-js.html#~displayImages">displayImages</a></li><li data-type='method'><a href="module-car-form-js.html#~getCarInfo">getCarInfo</a></li><li data-type='method'><a href="module-car-form-js.html#~handleImageInput">handleImageInput</a></li><li data-type='method'><a href="module-car-form-js.html#~submitForm">submitForm</a></li><li data-type='method'><a href="module-car-form-js.html#~unhideContent">unhideContent</a></li><li data-type='method'><a href="module-car-form-js.html#~uploadImage">uploadImage</a></li><li data-type='method'><a href="module-car-form-js.html#~uploadImages">uploadImages</a></li></ul></li><li><a href="module-car-list-js.html">car-list-js</a></li><li><a href="module-common-js.html">common-js</a><ul class='methods'><li data-type='method'><a href="module-common-js.html#~cancelLogout">cancelLogout</a></li><li data-type='method'><a href="module-common-js.html#~checkAlertEmpty">checkAlertEmpty</a></li><li data-type='method'><a href="module-common-js.html#~clearInputError">clearInputError</a></li><li data-type='method'><a href="module-common-js.html#~handleInputError">handleInputError</a></li><li data-type='method'><a href="module-common-js.html#~handleMsgCount">handleMsgCount</a></li><li data-type='method'><a href="module-common-js.html#~logoutHandler">logoutHandler</a></li><li data-type='method'><a href="module-common-js.html#~reformatErrorStr">reformatErrorStr</a></li><li data-type='method'><a href="module-common-js.html#~titleize">titleize</a></li></ul></li><li><a href="module-forgot-password-js.html">forgot-password-js</a><ul class='methods'><li data-type='method'><a href="module-forgot-password-js.html#~resetPassword">resetPassword</a></li></ul></li><li><a href="module-index-js.html">index-js</a><ul class='methods'><li data-type='method'><a href="module-index-js.html#~getEmailInput">getEmailInput</a></li></ul></li><li><a href="module-main-js.html">main-js</a><ul class='methods'><li data-type='method'><a href="module-main-js.html#~addCarparkMarker">addCarparkMarker</a></li><li data-type='method'><a href="module-main-js.html#~addMarker">addMarker</a></li><li data-type='method'><a href="module-main-js.html#~getData">getData</a></li><li data-type='method'><a href="module-main-js.html#~handleLocationError">handleLocationError</a></li><li data-type='method'><a href="module-main-js.html#~initMap">initMap</a></li><li data-type='method'><a href="module-main-js.html#~unhideContent">unhideContent</a></li></ul></li><li><a href="module-message-js.html">message-js</a><ul class='methods'><li data-type='method'><a href="module-message-js.html#~requestPermission">requestPermission</a></li></ul></li><li><a href="module-nav-js.html">nav-js</a><ul class='methods'><li data-type='method'><a href="module-nav-js.html#~unhideLogout">unhideLogout</a></li></ul></li><li><a href="module-profile-js.html">profile-js</a><ul class='methods'><li data-type='method'><a href="module-profile-js.html#~getRatings">getRatings</a></li><li data-type='method'><a href="module-profile-js.html#~getUploadedCars">getUploadedCars</a></li></ul></li><li><a href="module-register-js.html">register-js</a><ul class='methods'><li data-type='method'><a href="module-register-js.html#~signUpWithEmailPassword">signUpWithEmailPassword</a></li></ul></li><li><a href="module-sb-admin-2-min-js.html">sb-admin-2-min-js</a></li><li><a href="module-slideshow-js.html">slideshow-js</a><ul class='methods'><li data-type='method'><a href="module-slideshow-js.html#~currentSlide">currentSlide</a></li><li data-type='method'><a href="module-slideshow-js.html#~plusSlides">plusSlides</a></li><li data-type='method'><a href="module-slideshow-js.html#~showSlides">showSlides</a></li></ul></li><li><a href="module-svy21-js.html">svy21-js</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">profile.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @module profile-js
* @description This file renders the 'Profile' page. The page allows users to view their account information, 
including first name, last name, email, ratings and cars uploaded for rent.
*/

/* This line of code is importing the `initializeApp` function from the Firebase App SDK version
9.17.1. This function is used to initialize a Firebase app with the provided configuration object. */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";

/* `const firebaseConfig` is an object that contains the configuration information needed to initialize
a Firebase app. It includes the API key, authentication domain, project ID, storage bucket,
messaging sender ID, app ID, and measurement ID. This information is used to connect the app to the
Firebase services and resources specified in the configuration. */
const firebaseConfig = {
    apiKey: "AIzaSyClbXP8Ka7huRW2YkQEUGpT9Of6_bAIWCw",
    authDomain: "sc2006-1d9b8.firebaseapp.com",
    projectId: "sc2006-1d9b8",
    storageBucket: "sc2006-1d9b8.appspot.com",
    messagingSenderId: "18363617474",
    appId: "1:18363617474:web:de5535d545b6169e532b5b",
    measurementId: "G-NCKVJ8K4JJ"
};

/* `initializeApp(firebaseConfig);` is initializing a Firebase app with the provided configuration
object `firebaseConfig`. This function is imported from the Firebase App SDK version 9.17.1 and is
used to connect the app to the Firebase services and resources specified in the configuration. */
initializeApp(firebaseConfig);

/* This code is adding an event listener to the window object that waits for the page to fully load
before executing a function. The function uses jQuery to load the contents of two HTML files,
"nav.html" and "logout-model.html", into the respective elements with the IDs "nav-content" and
"logout-model" in the current page's HTML. This allows the navigation bar and logout modal to be
reused across multiple pages without duplicating code. */
window.addEventListener('load', function () {
    $(function () {
        $("#nav-content").load("nav.html");
        $("#logout-model").load("logout-model.html");
    });
}, false);


/* `const db = firebase.firestore();` is initializing a Firestore database instance and assigning it to
the constant variable `db`. This allows the code to interact with the Firestore database and perform
operations such as reading and writing data. */
const db = firebase.firestore();

/* The `firebase.auth().onAuthStateChanged()` function is a listener that is triggered whenever the
authentication state of the user changes. It takes a callback function as an argument that is
executed whenever the authentication state changes. */
firebase.auth().onAuthStateChanged(user => {
    if (user) {
        // User is signed in.
        const userID = user.uid;
        //console.log("UID: ", userID); DEBUG

        //get user's doc from "Users" collection
        db.collection("Users").doc(userID).get().then((doc) => {
            if (doc.exists) {
                //retrieve user data from doc
                const userData = doc.data();
                const firstName = userData.FirstName;
                const lastName = userData.LastName;
                const email = userData.Email;
                const rating = userData.Rating;

                //update DOM with retrieved data
                document.getElementById("user-fname").innerHTML = firstName;
                document.getElementById("user-lname").innerHTML = lastName;
                document.getElementById("user-email").innerHTML = email;

                getRatings(rating);
                getUploadedCars();
            } else {
                console.log("No such document!", doc);
            }
        }).catch((error) => {
            console.log("Error getting document:", error);
        });
    }
    else {
        // User is signed out.
        console.log(firebase.auth().currentUser);
    }
})

/**
 * The function calculates and sets the percentage width of a star rating system based on a given
 * rating.
 * @param {Number} rating - The rating parameter is a number that represents the rating value to be displayed.
 * It is used to calculate the percentage of stars to be filled and to display the number rating.
 */
function getRatings(rating) {
    //Total Stars
    const starsTotal = 5;

    const starPercentage = (rating / starsTotal * 100);

    //Round to nearest 10
    const starPercentageRounded = `${Math.round(starPercentage / 10) * 10}%`;

    //Set width of stars-inner to percentage
    document.querySelector('.stars-inner').style.width = starPercentageRounded;

    //Add number rating
    if (rating != undefined) {
        document.querySelector('.number-rating').innerHTML = rating;
    }
}

/**
 * This function retrieves and displays the cars that a user owns in their profile page.
 */
function getUploadedCars() {
    //to pull and display the car's that a user owns in his profile page
    const userID = localStorage.getItem("userId");
    const carsRef = db.collection("Cars");

    carsRef.where("CarOwner", "==", userID).orderBy("CreateDateTime", "desc").get()
        .then((carSnapshot) => {
            const carDocs = carSnapshot.docs; //need js array since the snapshot does not have a index for forEach

            //checking if array is empty.. if it is, we display message that user has not uploaded any car
            if (carDocs.length == 0) {
                console.log("User has not uploaded any cars!");
                document.getElementById("no-user-cars").removeAttribute("hidden");
            }

            carDocs.forEach((doc, index) => {
                //iterate through results and display car details
                const carData = doc.data();
                const carRef = doc.id;

                //retrieve car data
                const carNum = index + 1;
                const carBrandModel = carData.Brand + ' ' + carData.Model;
                const carImage = carData.Images[0]; //just the cover image
                const carPrice = carData.Price;
                const carRating = carData.Rating;
                const carSeats = carData.Seats;

                //unhiding the card
                const cardID = `profile-car-${carNum}`;
                document.getElementById(cardID).removeAttribute("hidden");

                //all element IDs
                const carBrandModelID = `profile-car-${carNum}-name`;
                const carImageID = `profile-car-${carNum}-img`;
                const carPriceID = `profile-car-${carNum}-price`;
                const carRatingID = `.stars-inner-car-${carNum}`;
                const carSeatsID = `profile-car-${carNum}-seats`;
                const carLinkID = `profile-car-${carNum}-link`;

                //inserting data into the cards
                document.getElementById(carBrandModelID).innerHTML = carBrandModel;
                document.getElementById(carImageID).src = carImage;
                document.getElementById(carPriceID).innerHTML = `$${carPrice}/day`;
                document.getElementById(carSeatsID).innerHTML = `${carSeats} seater`;
                document.getElementById(carLinkID).href = `car-detail.html?carId=${carRef}`;

                //inserting Rating into the card
                const starsTotal = 5;
                const starPercentage = (carRating / starsTotal * 100);
                const starPercentageRounded = `${Math.round(starPercentage / 10) * 10}%`;
                document.querySelector(carRatingID).style.width = starPercentageRounded;
            });
            document.getElementById("loading").setAttribute("hidden", true);
            document.getElementById("profileContainer").removeAttribute("hidden");
        })
        .catch((error) => {
            console.log("Error getting documents: ", error);
            document.getElementById("loading").setAttribute("hidden", true);
        });
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Sun Apr 09 2023 02:16:44 GMT+0800 (Singapore Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
